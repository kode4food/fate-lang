import nodeunit

let a0 = "parent"
let b0 = true

def scopeTest(test)
 	let greeting = "Not Hello"
 	def localGreeting()
 		let greeting = "Local Hello"
 		return greeting
	end
	test.equals(greeting,"Not Hello")
	test.equals(localGreeting(), "Local Hello")
	test.equals(greeting + " " + localGreeting(), "Not Hello Local Hello")
	test.done()
end

def nestedScopeTest(test)
	let a = 3
	let b = 4
	def first()
		let a = 12
		let b = 30
		def second()
			let a = 2
			let b = 3
			return a * b
		end
		return a + b + second()
	end	
	test.equals(a, 3)
	test.equals(b, 4)
	test.equals(first(), 48)
	test.done()	
end

def argumentsScopeTest(test)
	let a = 0
	let b = 0
	def add(a, b)
		return a + b
	end
	test.equals(add(2,3), 5)
	test.done()
end	

def scopeOverrideTest(test)
	let b = a0
	let a0 = "child"
	test.equals(a0, "child")
	test.equals(b, "parent")
	test.done()
end

def conditionalScopeTest(test)
	let c0 = a0
	if b0
		let a0 = "child"
		let d0 = a0
	end
	test.equals(a0, "child")
	test.equals(b0, true)
	test.equals(c0, "parent")
	test.equals(d0, "child")
	test.done()
end

let tests = nodeunit.testCase({
  "Testing Scopes": scopeTest,
  "Testing Nested Scopes": nestedScopeTest,
  "Testing Argument Scopes": argumentsScopeTest,
  "Testing Scope Overrides", scopeOverrideTest,
  "Testing Conditional Scopes": conditionalScopeTest
})

export tests